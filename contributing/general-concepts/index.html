<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-159199190-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Dark Documentation" href="/opensearch.xml"><title data-react-helmet="true">General concepts | Dark Documentation</title><meta data-react-helmet="true" property="og:image" content="https://docs.darklang.com/img/favicon.ico"><meta data-react-helmet="true" property="twitter:image" content="https://docs.darklang.com/img/favicon.ico"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Dark Documentation"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="General concepts | Dark Documentation"><meta data-react-helmet="true" name="description" content="Editor vs Production (how code runs)"><meta data-react-helmet="true" property="og:description" content="Editor vs Production (how code runs)"><meta data-react-helmet="true" property="og:url" content="https://docs.darklang.com/contributing/general-concepts"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.darklang.com/contributing/general-concepts"><link rel="stylesheet" href="/styles.f03e3bc4.css">
<link rel="preload" href="/styles.07077e44.js" as="script">
<link rel="preload" href="/runtime~main.971aee17.js" as="script">
<link rel="preload" href="/main.37eac891.js" as="script">
<link rel="preload" href="/1.14df050a.js" as="script">
<link rel="preload" href="/2.b7a2668d.js" as="script">
<link rel="preload" href="/90.44038b43.js" as="script">
<link rel="preload" href="/91.fb068903.js" as="script">
<link rel="preload" href="/05c17924.1b0ba798.js" as="script">
<link rel="preload" href="/17896441.60fa8c2c.js" as="script">
<link rel="preload" href="/79d66cde.4829b556.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a href="https://darklang.com" target="_blank" rel="noopener noreferrer" class="navbar__brand" to="https://darklang.com"><img class="navbar__logo" src="/img/favicon.ico" alt="Dark logo"><strong class="navbar__title">Dark</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/introduction">Documentation</a><a class="navbar__item navbar__link" href="/tutorials/tutorial-intro">Tutorials &amp; Samples</a><a class="navbar__item navbar__link" href="/slack-apps/slack-intro">Building Slack Apps</a><a class="navbar__item navbar__link" href="/contributing/getting-started">Contributing</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><div class="searchWrapper_-F3-"><span aria-label="expand searchbar" role="button" class="searchIconButton_1Dnz" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_2eto"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://darklang.com" target="_blank" rel="noopener noreferrer" class="navbar__brand" to="https://darklang.com"><img class="navbar__logo" src="/img/favicon.ico" alt="Dark logo"><strong class="navbar__title">Dark</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/introduction">Documentation</a></li><li class="menu__list-item"><a class="menu__link" href="/tutorials/tutorial-intro">Tutorials &amp; Samples</a></li><li class="menu__list-item"><a class="menu__link" href="/slack-apps/slack-intro">Building Slack Apps</a></li><li class="menu__list-item"><a class="menu__link" href="/contributing/getting-started">Contributing</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp" role="complementary"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Your First Contribution</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contributing/getting-started">Getting started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contributing/setting-up-the-repo">Setting up the Dark repo</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contributing/adding-your-first-test">Adding your first test</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contributing/making-your-first-pull-request">Making your first Pull Request</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Your Next Contributions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contributing/next-contribution">Your next contribution</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contributing/if-you-dont-know-ocaml">If you don&#x27;t know OCaml</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contributing/adding-a-function">Adding a built-in function</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contributing/adding-a-language-feature">Adding a language feature</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contributing/adding-a-refactoring">Adding a refactoring</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Working in the Dark repo</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/ocaml-for-dark-developers">OCaml for Dark developers</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/contributing/general-concepts">General concepts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/tour-of-editor">A tour of the Editor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/tour-of-backend">A tour of the Backend</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/repo-layout">Repository directory structure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/glossary">Glossary</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/debugging">Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/troubleshooting">Troubleshooting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contributing/making-a-pull-request">Making a Pull Request</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">General concepts</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="editor-vs-production-how-code-runs"></a>Editor vs Production (how code runs)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#editor-vs-production-how-code-runs" title="Direct link to heading">#</a></h2><p>Code runs in two places in Dark, in the Editor, and in Production. In
production, we have a Kubernetes cluster of interpreters with HTTP servers
which are connected to a database, connected to the internet via Google Cloud
infrastructure, that run Dark programs.</p><p>When requests are made in production we save their inputs and intermediate
values (combined, these form a &quot;trace&quot;, discussed below). Those are sent to the client.</p><p>The Dark interpreter is also compiled to Javascript and is available in the
browser in the client. The traces are sent to the JS-compiled interpreter,
which uses their results to fill in for functions which can&#x27;t be run on the
client (such as DB functions).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="traces--live-values"></a>Traces &amp; Live values<a aria-hidden="true" tabindex="-1" class="hash-link" href="#traces--live-values" title="Direct link to heading">#</a></h2><p>When a request is made to a production server, the inputs (typically a HTTP
request) are saved. We also save intermediate results of functions which are
called during the request. Together, these comprise a trace. Traces are shown
in the editor and users can choose between them.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="toplevels"></a>Toplevels<a aria-hidden="true" tabindex="-1" class="hash-link" href="#toplevels" title="Direct link to heading">#</a></h2><p>&quot;Toplevel&quot; is the generic name for a part of a Dark program, either a handler
(whether a HTTP handler, a Cron or a worker), a function, a type, or a database.</p><p>Structural toplevels are toplevels which are part of the structure of your
program: handlers and DBs. These live on the canvas.</p><p>Other toplevels are non-structural, and they don&#x27;t live on the canvas or really
anywhere. We have started to affectionately refer to the display for these as
the &quot;function space&quot;. (There is a design for what should happen here, but we
have not done it yet).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="the-path-of-an-edit"></a>The path of an edit<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-path-of-an-edit" title="Direct link to heading">#</a></h2><p>Most characters that you type are immediately saved in our production database (in, according to our claim, 50ms). Edits are either made to program code, which is part of the &quot;Fluid&quot; editing system, or to handlers, databases, function parameters, or similar metadata, which is part of the &quot;Forms&quot; editing system (originally, all edits were of the &quot;forms&quot; variety - the name was added post-hoc to differentiate it from &quot;fluid&quot;).</p><p>For Fluid, this is the journey:</p><ul><li>the event processed by <code>FluidKeyboard.ml</code>, creating a <code>FluidMsg</code></li><li>Fluid.ml recognized the <code>FluidMsg</code>, calling <code>updateKey</code></li><li><code>updateKey</code> looks at the current caret position, and at the &quot;tokens&quot; before
and after the caret, to figure out what&#x27;s happening</li><li><code>updateKey</code> makes a transformation based on whatever it decided</li><li>the AST for that code is transformed</li><li><code>FluidAutocomplete</code> may be regenerated, if necessary</li><li>the browser&#x27;s animation event fires, causing a re-render. The AST is
&quot;tokenized&quot;, essentially pretty-printing it as HTML, which then renders</li><li>an API call is made to send the change to the server (detailed below)</li></ul><p>For forms, the journey is similar:</p><ul><li>the event is processed by <code>KeyPress.ml</code></li><li>the contents of <code>m.complete.value</code> are updated (this is where the value in
the forms box is stored)</li><li>the <code>Autocomplete</code> values are regenerated</li><li>after pressing enter, or clicking away, the change is made</li><li>an API call is made to send the change to the server (detailed below)</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="sending-the-change-to-the-server"></a>Sending the change to the server<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sending-the-change-to-the-server" title="Direct link to heading">#</a></h3><p>When a change is made, typically an <code>AddOp</code> <code>modification</code> is made. That
<code>modification</code> is returned by many of the functions that edit programs, and
it&#x27;s processed in <code>Main.ml</code>. This passes into <code>API.ml</code>, where it serializes the
<code>Op</code> change into a JSON via encoders (see <code>Enconders.ml</code> and <code>Decoders.ml</code>).</p><p>The change is accepted by <code>api.ml</code> in the backend, where it is decoded, applied
to the program, and then saved into the database. Saving the program involves a
special binary serialization format, in <code>Serialization_format.ml</code>.</p><p>After being saved, it is sent to <code>Stroller</code>, a &quot;sidecar&quot; process in Rust that
sends it to Pusher.com, the websockets vendor we use. This is sent to other
clients which then update their programs. It is also sent to the original
editor, who ignores it.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="asts"></a>ASTs<a aria-hidden="true" tabindex="-1" class="hash-link" href="#asts" title="Direct link to heading">#</a></h2><p>An &quot;AST&quot; is an &quot;Abstract syntax tree&quot;. The simple explanation is that it&#x27;s a
set of &quot;classes&quot; and &quot;objects&quot; representing programs. (Abstract syntax tree
means the programs representation (the &quot;syntax tree&quot;) without the annoying
syntactic details like commas and semi-colons (hence &quot;abstract&quot;)).</p><p>In Dark, it&#x27;s defined in <code>FluidExpression.ml</code>, and at time of writing looks like this:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-ocaml codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> sendToRail </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> Rail</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> NoRail</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> expr  </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EInteger </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EBool </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> bool</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EString </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EFloat </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> ENull </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EBlank </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> ELet </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EIf </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EBinOp </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> sendToRail</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> ELambda </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> list </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EFieldAccess </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EVariable </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EFnCall </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr list </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> sendToRail</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EPartial </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> ERightPartial </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> ELeftPartial </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EList </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> ERecord </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">string </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EPipe </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EConstructor </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EMatch </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">pattern </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EPipeTarget </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> EFeatureFlag </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> expr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> pattern </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> FPVariable </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> FPConstructor </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> pattern list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> FPInteger </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> FPBool </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> bool</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> FPString </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> FPFloat </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> FPNull </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> FPBlank </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> id</span></div></div></div></div></div><p>These definitions are in OCaml (we have a <a href="/contributing/ocaml-for-dark-developers">guide to OCaml for Dark
developers</a>). Briefly, this means that an <code>expr</code> is
an integer (which is made up of an id and a string) or a bool (made up of an id
and a string), or a <code>match</code> (which is an id, an expression to match on, and a
list of patterns and expressions), etc</p><p>This definition is slightly simplified, but it&#x27;s close. There&#x27;s definitions for
literals like ints and strings, for definitions like <code>let</code>s, for function calls
with <code>EBinOp</code> and <code>EFnCall</code>, and also for various editor-specific intermediate
states like <code>EPartial</code> and <code>ERightPartial</code>.</p><p>Each expression has an <code>id</code> that is used to uniquely refer to the expression.
This is used when editing programs, and to relate live values from the analysis
engine to the display in the editor. If an ID is duplicated by accident, the
editor will act weirdly, but the program will work fine.</p><p><code>FluidPattern.ml</code> and <code>FluidExpression.ml</code> also contain functions for changing
patterns and expressions easily, either by changing the by ID or by traversing across the entire
structure. Traversing the structure is generally pretty fast.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/contributing/ocaml-for-dark-developers"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« OCaml for Dark developers</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/contributing/tour-of-editor"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">A tour of the Editor »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#editor-vs-production-how-code-runs" class="table-of-contents__link">Editor vs Production (how code runs)</a></li><li><a href="#traces--live-values" class="table-of-contents__link">Traces &amp; Live values</a></li><li><a href="#toplevels" class="table-of-contents__link">Toplevels</a></li><li><a href="#the-path-of-an-edit" class="table-of-contents__link">The path of an edit</a><ul><li><a href="#sending-the-change-to-the-server" class="table-of-contents__link">Sending the change to the server</a></li></ul></li><li><a href="#asts" class="table-of-contents__link">ASTs</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learning</h4><ul class="footer__items"><li class="footer__item"><a href="https://darklang.com/launch/demo-video" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://darklang.com/launch/demo-video">Demo Video</a></li><li class="footer__item"><a href="https://youtube.com/c/Darklang/videos" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://youtube.com/c/Darklang/videos">Tutorial Videos</a></li><li class="footer__item"><a href="https://darklang.com/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://darklang.com/docs">Docs</a></li><li class="footer__item"><a href="https://darklang.com/docs/tutorials" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://darklang.com/docs/tutorials">Tutorials &amp; Samples</a></li><li class="footer__item"><a href="https://darklang.com/docs/slack-apps" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://darklang.com/docs/slack-apps">Building Slack Apps</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">About</h4><ul class="footer__items"><li class="footer__item"><a href="https://darklang.com/about" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://darklang.com/about">Company</a></li><li class="footer__item"><a href="https://dev.to/darklang" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://dev.to/darklang">Dev Blog</a></li><li class="footer__item"><a href="https://medium.com/darklang" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://medium.com/darklang">Corp Blog</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://darklang.com/slack-invite" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://darklang.com/slack-invite">Community Slack</a></li><li class="footer__item"><a href="https://github.com/darklang/dark" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://github.com/darklang/dark">Dark Repo</a></li><li class="footer__item"><a href="https://github.com/darklang/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://github.com/darklang/docs">Docs Repo</a></li><li class="footer__item"><a class="footer__link-item" href="/contributing/getting-started">Contributor Docs</a></li><li class="footer__item"><a href="https://darklang.com/code-of-conduct" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://darklang.com/code-of-conduct">Code of Conduct</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Product</h4><ul class="footer__items"><li class="footer__item"><a href="https://darklang.com/login" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://darklang.com/login">Sign in</a></li><li class="footer__item"><a href="https://darklang.com/signup" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://darklang.com/signup">Sign up</a></li><li class="footer__item"><a href="https://darklang.com/desktop-client" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://darklang.com/desktop-client">Desktop Client</a></li><li class="footer__item"><a href="https://darklang.com/mailing-list" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://darklang.com/mailing-list">Mailing List</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 Dark Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.07077e44.js"></script>
<script src="/runtime~main.971aee17.js"></script>
<script src="/main.37eac891.js"></script>
<script src="/1.14df050a.js"></script>
<script src="/2.b7a2668d.js"></script>
<script src="/90.44038b43.js"></script>
<script src="/91.fb068903.js"></script>
<script src="/05c17924.1b0ba798.js"></script>
<script src="/17896441.60fa8c2c.js"></script>
<script src="/79d66cde.4829b556.js"></script>
</body>
</html>