"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8280],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>u});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=c(n),u=r,h=m["".concat(l,".").concat(u)]||m[u]||p[u]||o;return n?a.createElement(h,i(i({ref:t},d),{},{components:n})):a.createElement(h,i({ref:t},d))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},71836:(e,t,n)=>{n.r(t),n.d(t,{frontMatter:()=>s,contentTitle:()=>l,metadata:()=>c,toc:()=>d,default:()=>m});var a=n(87462),r=n(63366),o=(n(67294),n(3905)),i=["components"],s={id:"first-datastore",title:"Your first Datastore"},l=void 0,c={unversionedId:"first-datastore",id:"first-datastore",isDocsHomePage:!1,title:"Your first Datastore",description:"In the last section, we made a HTTP request that created a 404. We'll use _the",source:"@site/docs/first-datastore.md",sourceDirName:".",slug:"/first-datastore",permalink:"/first-datastore",editUrl:"https://github.com/darklang/docs/edit/main/docs/first-datastore.md",tags:[],version:"current",frontMatter:{id:"first-datastore",title:"Your first Datastore"}},d=[],p={toc:d};function m(e){var t=e.components,s=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},p,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"In the last section, we made a HTTP request that created a 404. We'll use ",(0,o.kt)("em",{parentName:"p"},"the\ntrace")," of that HTTP request to build an endpoint, a technique we call ",(0,o.kt)("strong",{parentName:"p"},"Trace\nDriven Development"),"."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Hit the plus (+) button in the 404 section of the sidebar. This creates a\nHTTP endpoint with the HTTP verb (POST) and path (/test) set from the request\nthat creates the 404.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img/gettingstarted/Screen_Shot_2020-02-11_at_10.44.54_AM.png",src:n(28487).Z})),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Hover over the white dot on the left hand side. Here, you can see the full\nbody of the incoming trace from when you posted to the endpoint from the\nREPL, including the body.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img/gettingstarted/Screen_Shot_2020-02-11_at_10.45.57_AM.png",src:n(87763).Z})),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Let's save the ",(0,o.kt)("inlineCode",{parentName:"li"},"request")," body to a variable by typing\n",(0,o.kt)("inlineCode",{parentName:"li"},"let data = request.body"),". As you can see, the autocomplete knows the field\nnames of ",(0,o.kt)("inlineCode",{parentName:"li"},"request")," from the trace, and will complete them for you.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img/gettingstarted/Screen_Shot_2020-02-11_at_10.47.10_AM.png",src:n(89457).Z})),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"Let's put this in a datastore. Like we saw with the ",(0,o.kt)("inlineCode",{parentName:"li"},"HttpClient"),' library,\ntyping "DB" in the blank will pull up all datastore functions.')),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img/gettingstarted/Screen_Shot_2020-02-11_at_10.48.24_AM.png",src:n(56117).Z})),(0,o.kt)("p",null,"In this case, we want ",(0,o.kt)("inlineCode",{parentName:"p"},"DB::set"),", which takes three arguments."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img/gettingstarted/Screen_Shot_2020-02-11_at_10.48.51_AM.png",src:n(77469).Z})),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},'Now let\'s make our datastore. From the sidebar or the omnibox, create a new\ndatastore called "Requests", with fields ',(0,o.kt)("inlineCode",{parentName:"li"},"data")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"time"),".")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img/gettingstarted/datastore.png",src:n(48530).Z})),(0,o.kt)("p",null,"Dark's datastores are key-value stores; each record has a unique key that is\nused to store and retrieve the value. For instance, a possible set of records\nwith keys in the above datastore would look like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},'{\n  key1: {\n          data: {\n                  test: "test2"\n                },\n          time: <Date: 2020-02-11T18:54:39Z>\n        },\n  key2: {\n          data: {\n                  test: "test1"\n                },\n          time: <Date: 2020-02-11T18:54:43Z>\n        }\n}\n')),(0,o.kt)("ol",{start:6},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Now that we have a datastore, let's finish our post endpoint."),(0,o.kt)("p",{parentName:"li"},"The first argument is the record we're inserting. This needs to match the\nschema, and so it needs to include both ",(0,o.kt)("inlineCode",{parentName:"p"},"date")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"time")," (you cannot insert\nrecords that are missing fields). Insert our data from above (seeing the live\nvalue to the left) and use the ",(0,o.kt)("inlineCode",{parentName:"p"},"Date::now")," function to get the ",(0,o.kt)("inlineCode",{parentName:"p"},"time")," field."))),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img/gettingstarted/Screen_Shot_2020-02-11_at_10.57.58_AM.png",src:n(17228).Z})),(0,o.kt)("ol",{start:7},(0,o.kt)("li",{parentName:"ol"},"We need a unique key for each record that we store. The ",(0,o.kt)("inlineCode",{parentName:"li"},"DB::generateKey"),"\nfunction generates random keys ","\u2013"," this is useful when your record has no\nobvious unique identifier.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img/gettingstarted/Screen_Shot_2020-02-11_at_10.59.24_AM.png",src:n(13167).Z})),(0,o.kt)("ol",{start:8},(0,o.kt)("li",{parentName:"ol"},"The final argument is the Datastore: ",(0,o.kt)("inlineCode",{parentName:"li"},"Requests"),".")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img/gettingstarted/Screen_Shot_2020-02-11_at_11.00.04_AM.png",src:n(65531).Z})),(0,o.kt)("ol",{start:9},(0,o.kt)("li",{parentName:"ol"},"To call the ",(0,o.kt)("inlineCode",{parentName:"li"},"DB::set")," function, we first need to run the two functions with\nside effects (",(0,o.kt)("inlineCode",{parentName:"li"},"DB::generateKey")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"Date::now"),") by hitting the play button.\nAfter hitting those two play buttons, the ",(0,o.kt)("inlineCode",{parentName:"li"},"DB::set")," play button will be\nenabled:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img/gettingstarted/Screen_Shot_2020-02-11_at_11.00.55_AM.png",src:n(83415).Z})),(0,o.kt)("ol",{start:10},(0,o.kt)("li",{parentName:"ol"},"Finally, hitting the play button for ",(0,o.kt)("inlineCode",{parentName:"li"},"DB::set")," inserts the record into the\ndatastore. This locks the datastore, preventing us from changing the schema,\nwhich we see indicated by the red lock (\ud83d\udd12) icon.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img/gettingstarted/Screen_Shot_2020-02-11_at_11.01.32_AM.png",src:n(5475).Z})))}m.isMDXComponent=!0},28487:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Screen_Shot_2020-02-11_at_10.44.54_AM-c35473b6dfa9e5e984e6c497c4948e03.png"},87763:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Screen_Shot_2020-02-11_at_10.45.57_AM-8b17b971fe9747128d7c1727dd0c2b35.png"},89457:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Screen_Shot_2020-02-11_at_10.47.10_AM-e5c3345e0e4829d3bc00434b91af58eb.png"},56117:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Screen_Shot_2020-02-11_at_10.48.24_AM-8d398f548be064fee18156e499c7c30f.png"},77469:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Screen_Shot_2020-02-11_at_10.48.51_AM-d65c3a3c6bbf857e9f0253221e0c2252.png"},17228:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Screen_Shot_2020-02-11_at_10.57.58_AM-f9ccb9d544162a11defc7e20bcc5ea43.png"},13167:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Screen_Shot_2020-02-11_at_10.59.24_AM-5c778802071561f8d56509c54f32fb70.png"},65531:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Screen_Shot_2020-02-11_at_11.00.04_AM-f3d0b9106b682171db316604ac028bf0.png"},83415:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Screen_Shot_2020-02-11_at_11.00.55_AM-2f4c3e09ce0ebdfeb8d9c7b7329e6ade.png"},5475:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/Screen_Shot_2020-02-11_at_11.01.32_AM-2a8cc63ff21c7e9cefa65a72268eb83d.png"},48530:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/datastore-4ddeab6316dd6d42a9f40131e5aab4d8.png"}}]);